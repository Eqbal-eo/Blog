<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <%
    function toArabicNumbers(str) {
      return str.toString().replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
    }
  
    function formatDate(dateString) {
      const months = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
      const date = new Date(dateString);
      const day = toArabicNumbers(date.getDate());
      const month = months[date.getMonth()];
      const year = toArabicNumbers(date.getFullYear());
      return `${day} ${month} ${year}`;
    }
    %>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= post.title %> -  مدونات آفاق</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/js/css/home.css">
    <link rel="stylesheet" href="/js/css/footer.css">
    
    <!-- Add Prism.js for code syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
    
    <style>
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: 'Tajawal', sans-serif;
        display: flex;
        flex-direction: column;
        background-color: #f9f7f0;
    }

    /* Add spacing between navbar and content */
    main {
        margin-top: 40px; /* Increase spacing between navbar and content */
        flex: 1 0 auto; /* Makes content take available space */
        display: flex;
        flex-direction: column;
    }
    
    .section {
        padding-top: 20px; /* Increase padding */
        padding-bottom: 40px; /* Large bottom spacing to distance content from footer */
        flex-grow: 1; /* Expand section to fill available space */
    }
    
    .container {
        height: 100%; /* Takes parent height */
    }
      /* Keep content at top instead of centering */
    .row.justify-content-center {
        align-items: flex-start;
        min-height: 100%;
    }
    
    .col-md-9 {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }
    
    footer {
        flex-shrink: 0; /* Prevents footer from shrinking */
        margin-top: auto; /* Ensures footer stays at bottom */
        padding-top: 15px; /* Inner spacing above footer */
    } 
    
    /* Cancel hover effects */
    .navbar-brand:hover,
    .nav-link:hover,
    .btn:hover,
    a:hover {
        opacity: 1 !important;
        transform: none !important;
        box-shadow: none !important;
        background-color: inherit !important;
        color: inherit !important;
        text-decoration: none !important;
        transition: none !important;
    }
      /* Cancel movement and zoom effects for cards on click or hover */
    .card,
    .card:hover,
    .card:active,
    .card:focus,
    .card-body,
    .card-body:hover,
    .card-body:active,
    .card-body:focus {
        transform: none !important;
        transition: none !important;
        box-shadow: none !important; /* Remove shadow completely */
        margin: 0 !important;
        padding: 0 !important;
    }
    
    /* Ensure elements don't zoom on touch on mobile devices */
    * {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }    .post-info {
        font-size: 0.9rem;
        color: #a8a6a6;
        margin-top: 0; /* إلغاء المسافة العلوية */
        margin-bottom: 20px; /* تقليل المسافة السفلية من 1rem */
        text-align: center; /* تغيير من right إلى center لجميع الشاشات */
        width: 100%;
    }.post-title {
        font-weight: bold;
        font-size: 2rem;
        margin-top: 40px;
        margin-bottom: 8px; /* تقليل المسافة من 15px إلى 8px */
        text-align: center; /* توسيط العنوان في جميع الشاشات */
        width: 100%;
    }

    .post-content {
        font-size: 1rem;
        line-height: 1.8; /* زودت التباعد بين الأسطر لتسهيل القراءة */
        font-weight: 400;
        padding: 1rem 1.5rem; /* مسافة من الأعلى والأسفل ومن اليمين واليسار */
        text-align: right; /* محاذاة النص لليمين */
        width: 100%;
    }.card {
        width: 100%; /* Full width for card */
        margin-bottom: 40px; /* Extra bottom spacing */
        border: 1px solid #e9e9e9 !important; /* Lighten border color */
        box-shadow: none !important; /* Remove shadow */
    }

    .card-body {
        padding: 0; /* Cancel default padding for card since we added it inside post-content */
    }
    
    /* Code formatting */
    .post-content pre {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        margin: 1.5rem 0;
        overflow-x: auto;
        direction: ltr;
        text-align: left;
        font-family: 'Courier New', Consolas, Monaco, monospace;
        font-size: 0.9rem;
        line-height: 1.4;
        position: relative;
    }
    
    /* Code container with copy button */
    .code-container {
        position: relative;
        margin: 1.5rem 0;
    }
    
    .code-container pre {
        margin: 0;
    }
    
    /* Copy code button */
    .copy-code-btn {
        position: absolute;
        top: 8px;
        right: 18px;
        background: #374151;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 11px;
        cursor: pointer;
        opacity: 0.7;
        transition: all 0.2s ease;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 3px;
        font-family: 'Tajawal', sans-serif;
        min-width: auto;
        height: auto;
        margin-bottom: 20px;
    }
    
    .copy-code-btn:hover {
        opacity: 1;
        background: #4b5563;
        transform: scale(1.02);
    }
    
    .copy-code-btn.copied {
        background: #10b981;
    }
    
    .copy-code-btn i {
        font-size: 10px;
    }
    
    /* Improve code appearance with copy button */
    .code-container pre {
        padding-top: 35px;
    }
    
    .post-content pre code {
        background: none;
        padding: 0;
        border: none;
        font-size: inherit;
        color: inherit;
    }
    
    .post-content code {
        background-color: #c0c2c3;
        padding: 2px 4px;
        border-radius: 4px;
        font-family: 'Courier New', Consolas, Monaco, monospace;
        font-size: 0.85em;
        color: #d63384;
        direction: ltr;
        display: inline;
    }
    
    /* Improve code display in Prism.js */
    .post-content .token.keyword {
        color: #0000ff;
        font-weight: bold;
    }
    
    .post-content .token.string {
        color: #008000;
    }
    
    .post-content .token.comment {
        color: #008000;
        font-style: italic;
    }
    
    .post-content .token.number {
        color: #ff6600;
    }
    
    .post-content .token.function {
        color: #660e7a;
    }
    
    /* Line numbers formatting */
    .post-content .line-numbers {
        background: #f5f5f5;
        border-right: 1px solid #ddd;
        padding-right: 10px;
        margin-right: 10px;
    }
    
    /* Share and print buttons formatting - professional design */
    .post-actions {
        margin-top: 2rem;
        padding: 1.5rem 1rem;
        background:none;
        border-radius: 12px;
        border: none;
        box-shadow: 0 2px 10px rgba(140, 74, 33, 0.08);
        position: relative;
        overflow: hidden;
    }
    
    .post-actions::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #8c4a21ca, #a0552a, #8c4a21ca);
    }
    
    .share-section {
        text-align: center;
    }
    
    .share-title {
        color: #8c4a21ca;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 1.2rem;
        position: relative;
        display: inline-block;
        padding: 0 0.8rem;
    }
    
    .share-title::before,
    .share-title::after {
        content: '';
        position: absolute;
        top: 50%;
        width: 40px;
        height: 1px;
        background: #8c4a21ca;
        opacity: 0.5;
    }
    
    .share-title::before {
        right: 100%;
        margin-right: 8px;
    }
    
    .share-title::after {
        left: 100%;
        margin-left: 8px;
    }
    
    .share-title i {
        margin-left: 0.4rem;
        color: #8c4a21ca;
    }
    
    .share-buttons {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.8rem;
    }
    
    .social-btn { 
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1.5px solid #8c4a21ca;
        background: #ffffff;
        color: #8c4a21ca;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(140, 74, 33, 0.12);
    }
    
    .social-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #8c4a21ca;
        transform: scale(0);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 50%;
    }
    
    .social-btn:hover { 
        transform: translateY(-2px);
        border-color: #a0552a;
        box-shadow: 0 4px 15px rgba(140, 74, 33, 0.2);
    }
    
    .social-btn:hover::before {
        transform: scale(1);
    }
    
    .social-btn:hover i {
        color: #ffffff;
        transform: scale(1.05);
        position: relative;
        z-index: 1;
    }
    
    .social-btn:active {
        transform: translateY(-1px);
    }
    
    .social-btn i {
        transition: all 0.3s ease;
        position: relative;
        z-index: 1;
    }
    
    /* Special effects for different buttons */
    .facebook-btn:hover {
        border-color: #a0552a;
    }
    
    .twitter-btn:hover {
        border-color: #a0552a;
    }
    
    .whatsapp-btn:hover {
        border-color: #a0552a;
    }
    
    .linkedin-btn:hover {
        border-color: #a0552a;
    }
    
    .copy-btn:hover {
        border-color: #a0552a;
    }
    
    .print-btn:hover {
        border-color: #a0552a;
    }
    
    @media screen and (max-width: 768px) {
        .post-title {
            font-size: 1.5rem; /* Font size on small screens */
            margin-top: 4rem; /* Top spacing on small screens */
        }

        .post-info {
            text-align: center; /* Center post info */
        }

        .post-content {
            font-size: 0.9rem;
            line-height: 1.8;
            font-weight: 400;
            padding: 1rem;
            text-align: right;
        }
          /* Remove card effect on small screens */
        .card.shadow-sm {
            box-shadow: none !important;
            background: white;
            border: 1px solid #e9e9e9 !important; /* Lighten borders on small screens too */
        }
        
        /* Center content on screen */
        .col-md-9 {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-left: 10px;
            padding-right: 10px;
        }
        
        /* Improve share buttons on small screens */
        .post-actions {
            margin-top: 1.5rem;
            padding: 1.2rem 0.8rem;
        }
        
        .share-title {
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .share-title::before,
        .share-title::after {
            width: 25px;
        }
        
        .share-buttons {
            gap: 0.6rem;
        }
        
        .social-btn {
            width: 36px;
            height: 36px;
            font-size: 0.9rem;
        }
        
        /* Adjust content width to be centered */
        .post-content-container {
            width: 100%;
            max-width: 90%;
            margin: 0 auto;
        }
    }
    
    /* iPad screen customization */
    @media screen and (min-width: 768px) and (max-width: 1024px) {
        .section {
            padding-bottom: 80px; /* Larger bottom spacing for iPad screens */
        }
        
        main {
            margin-bottom: 30px; /* Extra bottom margin for main content */
        }
        
        .card {
            margin-bottom: 60px; /* Larger spacing below card on iPad */
        }
        
        .post-content-container {
            width: 95%;
            margin: 0 auto;
        }
    }
</style>

</head>

<body>    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand fw-bold brand-title" href="/">مدونات آفاق</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                aria-label="Toggle navigation" id="navbar-toggler">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNavbar">
                <ul class="navbar-nav ms-auto gap-1 mb-1 mb-lg-0">
                    <a href="/" class="btn btn-outline-dark btn-small">الرئيسية</a>
                    <a href="/blogs" class="btn btn-outline-dark btn-small">المدونات</a>
                    <a href="/about" class="btn btn-outline-dark btn-small">عن المنصة</a>
                </ul>
                <div class="d-flex align-items-center gap-2 auth-buttons">
                    <a href="/login" class="btn btn-outline-dark-log px-3 py-2 text-nowrap">تسجيل الدخول</a>
                    <a href="/register" class="btn btn-primary px-3 py-2 text-nowrap">إنشاء حساب</a>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Single post -->
        <section class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-9 mb-4">
                        <!-- Post title outside the post box -->
                        <h1 class="post-title">
                            <%= post.title %>
                        </h1>

                        <!-- Post info (publisher name and date) outside the box -->
                        <div class="post-info">
                            <small>
                                بواسطة <%= post.users.displayName %> 
                                <span>-</span> 
                                نُشرت في <%= formatDate(post.created_at) %>
                                <% if (post.category) { %>
                                    <span>-</span>
                                    <span class="post-category">
                                        <%= {
                                            'politics': 'سياسة',
                                            'history': 'تاريخ',
                                            'economics': 'اقتصاد',
                                            'technology': 'تكنلوجيا',
                                            'literature': 'أدب',
                                            'medicine': 'طب'
                                        }[post.category] || post.category %>
                                    </span>
                                <% } %>
                            </small>
                        </div>

                        <!-- Post box -->
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="card-text post-content post-content-container">
                                    <%- post.content %>
                                </div>
                                
                                <!-- Share and print buttons -->
                                <div class="post-actions">
                                    <div class="share-section">
                                        <h6 class="share-title">
                                            <i class="fas fa-share-alt"></i>
                                            مشاركة المقال
                                        </h6>
                                        <div class="share-buttons">
                                            <button class="social-btn facebook-btn" onclick="shareOnFacebook()" title="مشاركة على فيسبوك">
                                                <i class="fab fa-facebook-f"></i>
                                            </button>
                                            <button class="social-btn twitter-btn" onclick="shareOnTwitter()" title="مشاركة على تويتر">
                                                <i class="fab fa-twitter"></i>
                                            </button>
                                            <button class="social-btn whatsapp-btn" onclick="shareOnWhatsApp()" title="مشاركة على واتساب">
                                                <i class="fab fa-whatsapp"></i>
                                            </button>
                                            <button class="social-btn linkedin-btn" onclick="shareOnLinkedIn()" title="مشاركة على لينكد إن">
                                                <i class="fab fa-linkedin-in"></i>
                                            </button>
                                            <button class="social-btn copy-btn" onclick="copyLink()" title="نسخ الرابط">
                                                <i class="fas fa-link"></i>
                                            </button>
                                            <button class="social-btn print-btn" onclick="printPost()" title="طباعة المقال">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        مدونات آفاق | منصة للتدوين الثقافي والفكري © 2025
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Add Prism.js for code syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <script>
        // Activate Prism.js for code formatting
        document.addEventListener('DOMContentLoaded', function() {
            // Search for all pre elements in content
            const preElements = document.querySelectorAll('.post-content pre');
            
            preElements.forEach(function(pre) {
                // Create code container with copy button
                const codeContainer = document.createElement('div');
                codeContainer.className = 'code-container';
                
                // Create copy button
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-code-btn';
                copyBtn.innerHTML = '<i class="fas fa-copy"></i> نسخ';
                
                // Insert container in place of original pre element
                pre.parentNode.insertBefore(codeContainer, pre);
                codeContainer.appendChild(copyBtn);
                codeContainer.appendChild(pre);
                
                // Add line-numbers class for numbered lines
                pre.classList.add('line-numbers');
                
                // Add language class if not present
                const codeElement = pre.querySelector('code');
                if (codeElement && !codeElement.className) {
                    codeElement.className = 'language-javascript'; // Default language
                }
                
                // Add copy function
                copyBtn.addEventListener('click', async function() {
                    try {
                        const codeText = codeElement ? codeElement.textContent : pre.textContent;
                        await navigator.clipboard.writeText(codeText);
                        
                        // Change button text temporarily
                        const originalHTML = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> تم النسخ';
                        copyBtn.classList.add('copied');
                        
                        setTimeout(function() {
                            copyBtn.innerHTML = originalHTML;
                            copyBtn.classList.remove('copied');
                        }, 2000);
                        
                    } catch (err) {
                        console.error('Failed to copy code:', err);
                        // Alternative copy method
                        const textArea = document.createElement('textarea');
                        textArea.value = codeElement ? codeElement.textContent : pre.textContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        const originalHTML = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> تم النسخ';
                        copyBtn.classList.add('copied');
                        
                        setTimeout(function() {
                            copyBtn.innerHTML = originalHTML;
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    }
                });
            });
            
            // Activate Prism
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }
        });
        
        // Share and print functions
        function shareOnFacebook() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('<%= post.title %>');
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
        }
        
        function shareOnTwitter() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('<%= post.title %>');
            const text = encodeURIComponent('اطلعوا على هذا المقال الرائع: ');
            window.open(`https://twitter.com/intent/tweet?text=${text}${title}&url=${url}`, '_blank', 'width=600,height=400');
        }
        
        function shareOnWhatsApp() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('<%= post.title %>');
            const text = encodeURIComponent('اطلعوا على هذا المقال الرائع: ');
            window.open(`https://api.whatsapp.com/send?text=${text}${title}%20${url}`, '_blank');
        }
        
        function shareOnLinkedIn() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('<%= post.title %>');
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank', 'width=600,height=400');
        }
        
        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(function() {
                // Change button icon temporarily
                const btn = event.target.closest('button');
                const icon = btn.querySelector('i');
                const originalClass = icon.className;
                
                icon.className = 'fas fa-check';
                btn.style.background = '#8c4a21ca';
                btn.style.borderColor = '#8c4a21ca';
                btn.style.color = 'white';
                
                setTimeout(function() {
                    icon.className = originalClass;
                    btn.style.background = '#ffffff';
                    btn.style.borderColor = '#8c4a21ca';
                    btn.style.color = '#8c4a21ca';
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy link:', err);
                // Alternative copy method
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Visual confirmation of copy
                const btn = event.target.closest('button');
                const icon = btn.querySelector('i');
                const originalClass = icon.className;
                
                icon.className = 'fas fa-check';
                btn.style.background = '#8c4a21ca';
                btn.style.borderColor = '#8c4a21ca';
                btn.style.color = 'white';
                
                setTimeout(function() {
                    icon.className = originalClass;
                    btn.style.background = '#ffffff';
                    btn.style.borderColor = '#8c4a21ca';
                    btn.style.color = '#8c4a21ca';
                }, 2000);
            });
        }
        
        function printPost() {
            // Hide unwanted elements from printing
            const elementsToHide = document.querySelectorAll('nav, .post-actions, footer');
            elementsToHide.forEach(el => el.style.display = 'none');
            
            // Print page
            window.print();
            
            // Re-show elements after printing
            elementsToHide.forEach(el => el.style.display = '');
        }
    </script>
</body>

</html>