require('dotenv').config();
const supabase = require('./db/db');

async function testApproval() {
    try {
        console.log('๐ ุฌุงุฑู ุงูุจุญุซ ุนู ุทูุจุงุช ุงููุฏููุฉ ุงููุนููุฉ...');
        
        // ุงูุจุญุซ ุนู ุทูุจุงุช ูุนููุฉ
        const { data: requests, error: fetchError } = await supabase
            .from('blog_requests')
            .select('*')
            .eq('status', 'pending')
            .limit(5);
            
        if (fetchError) {
            console.error('ุฎุทุฃ ูู ุฌูุจ ุงูุทูุจุงุช:', fetchError);
            return;
        }
        
        console.log(`โ ุชู ุงูุนุซูุฑ ุนูู ${requests.length} ุทูุจ ูุนูู`);
        
        if (requests.length === 0) {
            console.log('๐ ุฅูุดุงุก ุทูุจ ุงุฎุชุจุงุฑ...');
            
            // ุฅูุดุงุก ุทูุจ ุงุฎุชุจุงุฑ
            const { data: newRequest, error: insertError } = await supabase
                .from('blog_requests')
                .insert([{
                    full_name: 'ุงุฎุชุจุงุฑ ุงููุณุชุฎุฏู',
                    email: 'test@example.com',
                    phone: '1234567890',
                    blog_topic: 'ูุฏููุฉ ุชูููุฉ ูุชุฎุตุตุฉ ูู ุงูุจุฑูุฌุฉ ูุงูุชุทููุฑ',
                    experience_level: 'ูุชูุณุท',
                    writing_samples: 'ูุฐุง ูููุฐุฌ ูุชุงุจุฉ ุงุฎุชุจุงุฑู ููุชุญูู ูู ูุธููุฉ ุงูููุงููุฉ ุนูู ุทูุจุงุช ุงููุฏููุฉ. ูุญุชูู ูุฐุง ุงููุต ุนูู ุฃูุซุฑ ูู 250 ูููุฉ ููุง ูู ูุทููุจ ูู ุงููุธุงู. ุณุฃููู ุจุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงููููุงุช ูููุตูู ููุญุฏ ุงููุทููุจ. ุชุทููุฑ ุงูููุงูุน ุงูุฅููุชุฑูููุฉ ูุฌุงู ูุงุณุน ููุชููุน ูุชุทูุจ ูุนุฑูุฉ ุนูููุฉ ุจุงูุชูููุงุช ุงููุฎุชููุฉ ูุซู HTML ูCSS ูJavaScript. ููุง ูุชุทูุจ ููู ููุงุนุฏ ุงูุจูุงูุงุช ูููููุฉ ุงูุชุนุงูู ูุนูุง. ุงูุจุฑูุฌุฉ ูู ูุนูู ูู ุงูููุช ููุณู ุชุญุชุงุฌ ุฅูู ุตุจุฑ ููุซุงุจุฑุฉ ูุชุนูู ูุณุชูุฑ. ุงูุชูููุงุช ุชุชุทูุฑ ุจุงุณุชูุฑุงุฑ ููุฌุจ ุนูู ุงููุทูุฑ ููุงูุจุฉ ูุฐุง ุงูุชุทูุฑ. ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุฃุตุจุญ ุฌุฒุกุงู ูููุงู ูู ุนุงูู ุงูุชูููุฉ ุงูููู ููุคุซุฑ ุนูู ูุซูุฑ ูู ุงููุฌุงูุงุช. ุชุนูู ุงูุจุฑูุฌุฉ ููุชุญ ุขูุงูุงู ูุงุณุนุฉ ููุฅุจุฏุงุน ูุงูุงุจุชูุงุฑ. ุงููุดุงุฑูุน ุงูุชูููุฉ ุชุญุชุงุฌ ุฅูู ุชุฎุทูุท ุฌูุฏ ูุชูููุฐ ุฏููู ูุถูุงู ุงููุฌุงุญ.',
                    motivation: 'ุฃุฑูุฏ ูุดุงุฑูุฉ ุฎุจุฑุชู ูู ูุฌุงู ุงูุชุทููุฑ ูุงูุจุฑูุฌุฉ ูุน ุงูุขุฎุฑูู',
                    status: 'pending'
                }])
                .select()
                .single();
                
            if (insertError) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุทูุจ:', insertError);
                return;
            }
            
            console.log('โ ุชู ุฅูุดุงุก ุทูุจ ุงุฎุชุจุงุฑ:', newRequest);
            return newRequest;
        } else {
            console.log('๐ ุงูุทูุจุงุช ุงููุนููุฉ:');
            requests.forEach((req, index) => {
                console.log(`${index + 1}. ${req.full_name} - ${req.email} (ID: ${req.id})`);
            });
            return requests[0];
        }
        
    } catch (error) {
        console.error('ุฎุทุฃ ุนุงู:', error);
    }
}

// ุชุดุบูู ุงูุงุฎุชุจุงุฑ
testApproval().then(result => {
    if (result) {
        console.log('\n๐ฏ ููููู ุงูุขู ุงุฎุชุจุงุฑ ุงูููุงููุฉ ุนูู ุงูุทูุจ ุฑูู:', result.id);
        console.log('๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:', result.email);
    }
    process.exit(0);
});
